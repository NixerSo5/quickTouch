<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickTouch</title>
</head>
<style>
    .image-div {
        width: 100%;
        height: 100%;
    }

    .choice-box {
        border: 1px solid gray;
        height: 150px;
        width: 150px;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .dragover {
        border: 1px solid red;
    }

    .choice-div {
        width: 100%;
        height: 430px;
        background-color: black;

        display: flex;
        flex-direction: row;
        flex-flow: wrap;
        justify-content: space-between;
        align-items: center;
    }


    .image-div {
        width: 100px;
        height: 100px;
        border: 1px dashed gray;
    }

    .button {
        width: 120px;
        height: 38px;
        background-color: blue;
        color: white;
        border-radius: 3px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .main-div{
        width: 945px;
        height: 500px;
    }
    body,html{
        margin: 0;
        padding: 0;
        overflow: hidden; /* 禁用滚动条 */
    }
    .qrcode-div{
        width: 945px;height: 500px;
        display: none;
        background-color: black;
    }
</style>
<body>
<div style="" id="main-div" class="main-div">
    <div style="" class="choice-div">
        <div style="height: 10px;width: 100%;"></div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path=""  class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>
        <div style="" class="choice-box drop-area">
            <div>
                <div class="image-div file-info"></div>
            </div>
            <div nv-name=""  nv-iconb64="" nv-path="" class="file-name">
            </div>
        </div>

        <div style="height: 10px;width: 100%;">
        </div>

    </div>
    <div style="height: 40px;width: 100%;margin-top:2px;display: flex;justify-content: space-around">
        <div type="button" id="button-save" class="button">保存配置</div>
        <div type="button" id="button-link" class="button">连接QRcode</div>
    </div>
</div>
<div id="qrcode-div" class="qrcode-div ">
    <div style="width: 100%;height: 100%;color: white;display: flex;align-items: center;justify-content: center;flex-direction: column">
         <div style="display: flex;flex-direction: column;width: 200px;height: 240px">
             <div style="border: 1px solid greenyellow;height: 200px">
                 <img src="" style="width: 100%;height: 100%" id="qrcode">
             </div>
             <div style="height: 40px;display: flex;justify-content: space-around;align-items: center;flex-direction: column">
              <span>连接APP在同一网络</span>
             <span>扫描二维码</span>
             </div>
         </div>
        <div class="button" id="close-button">关闭</div>
    </div>

</div>
</body>
<script src="./renderer.js"></script>
<script>
    const dropAreas = document.getElementsByClassName('drop-area');
    const saveButton = document.querySelector('#button-save');
    const linkButton = document.querySelector('#button-link');
    const closeButton = document.querySelector('#close-button');


    linkButton.addEventListener('click', () => {
        document.getElementById('main-div').style.display = 'none';
        document.getElementById('qrcode-div').style.display='block';
    })
    closeButton.addEventListener('click', () => {
        document.getElementById('main-div').style.display = 'block';
        document.getElementById('qrcode-div').style.display='none';
    })

    Array.from(dropAreas).forEach((dropArea) => {
        const fileInfo = dropArea.querySelector('.file-info');
        const fileName = dropArea.querySelector('.file-name');
        dropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy'; // 显示允许拖动的指示
            dropArea.classList.add('dragover');
        });
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('dragover');
        });
        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dropArea.classList.remove('dragover');
            if (event.dataTransfer.types.includes('Files') && !event.dataTransfer.types.includes('text/html')) {
                const files = event.dataTransfer.files;
                if (files.length > 0) {
                    const filePath = files[0].path;
                    window.electron.getFileIcon(filePath, (iconData) => {
                        const img = new Image();
                        img.src = iconData.icon;
                        img.className = 'image-div';
                        fileName.innerHTML = files[0].name;
                        fileName.setAttribute("nv-path",iconData.filePath);
                        fileName.setAttribute("nv-iconb64",iconData.icon);
                        fileName.setAttribute("nv-name",files[0].name);
                        fileInfo.innerHTML = '';
                        fileInfo.appendChild(img);
                    });
                }
            }
        });
    })
    saveButton.addEventListener('click', () => {
       const datalist = document.querySelectorAll('.file-name');
       const data = [];
       datalist.forEach((item) => {
           const path = item.getAttribute("nv-path");
           const icon = item.getAttribute("nv-iconb64");
           const name = item.getAttribute("nv-name");
           data.push({
               path,
               icon,
               name
           })
       })
        window.electron.saveConfig(data, (result) => {
            if (result.success) {
                alert('保存成功');
            } else {
                alert('保存失败')
            }
        });
    });
    window.electron.onQRCode((dataURL) => {
        const qrCodeImage = document.getElementById('qrcode');
        qrCodeImage.src = dataURL;
    });
    window.electron.onConfigData((configData) => {
    Array.from(dropAreas).forEach((dropArea,index) => {
        if(configData[index].path){
            const fileInfo = dropArea.querySelector('.file-info');
            const fileName = dropArea.querySelector('.file-name');
            fileName.innerHTML = configData[index].name;
            fileName.setAttribute("nv-path",configData[index].path);
            fileName.setAttribute("nv-iconb64",configData[index].icon);
            fileName.setAttribute("nv-name",configData[index].name);
            fileInfo.innerHTML = '';
            const img = new Image();
            img.src = configData[index].icon;
            img.className = 'image-div';
            fileInfo.appendChild(img);
        }
    })
    });

</script>
</html>
